<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portfólio - Matheus Bonotto</title>
  
  <!-- PWA Meta Tags (Component) -->
  <script>
    document.write(window.renderPWAMetaTags ? window.renderPWAMetaTags() : '');
  </script>
  
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css" rel="stylesheet">
  
  <!-- Estilos -->
  <link rel="stylesheet" href="assets/css/main.css">
  <link rel="stylesheet" href="assets/css/portfolio.css">
  
  <!-- Configuração -->
  <script src="config.js"></script>
  
  <!-- Supabase UMD -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>
  
  <!-- Inicializar Supabase globalmente -->
  <script>
    (function() {
      function initGlobalSupabase() {
        if (typeof window.supabase === 'undefined') {
          setTimeout(initGlobalSupabase, 100);
          return;
        }
        if (!window.CONFIG || !window.CONFIG.SUPABASE_URL || !window.CONFIG.SUPABASE_ANON_KEY) {
          setTimeout(initGlobalSupabase, 100);
          return;
        }
        try {
          let createClient = null;
          if (window.supabase.createClient) {
            createClient = window.supabase.createClient;
          } else if (typeof window.supabase === 'function') {
            createClient = window.supabase;
          } else if (window.supabase.default && window.supabase.default.createClient) {
            createClient = window.supabase.default.createClient;
          }
          if (createClient) {
            window.__supabaseClient = createClient(window.CONFIG.SUPABASE_URL, window.CONFIG.SUPABASE_ANON_KEY);
            console.log('✅ Supabase inicializado globalmente');
          }
        } catch (error) {
          console.error('❌ Erro ao inicializar Supabase globalmente:', error);
        }
      }
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initGlobalSupabase);
      } else {
        initGlobalSupabase();
      }
    })();
  </script>
</head>
<body>
  <div x-data="portfolioGrid()" x-init="loadProjects()">
    <!-- Header Component -->
    <div id="header-placeholder"></div>

    <!-- Hero Section -->
    <section class="hero-section">
      <div class="hero-background"></div>
      <div class="container text-center position-relative">
        <div class="hero-content">
          <h1 class="hero-title">
            <i class="bi bi-folder-fill me-3"></i>
            Portfólio
          </h1>
          <p class="hero-subtitle">Projetos e trabalhos realizados</p>
          <div class="hero-stats" x-show="!loading">
            <div class="stat-item">
              <div class="stat-number" x-text="projects.length"></div>
              <div class="stat-label">Projetos</div>
            </div>
            <div class="stat-item">
              <div class="stat-number" x-text="getUniqueCategories().length"></div>
              <div class="stat-label">Categorias</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Filtros -->
    <section class="filters-section">
      <div class="container">
        <!-- Busca -->
        <div class="search-wrapper mb-4">
          <div class="search-input-wrapper">
            <i class="bi bi-search search-icon"></i>
            <input 
              type="text" 
              class="form-control search-input" 
              x-model="searchQuery"
              @input="filterProjects()"
              placeholder="Buscar projetos por título, descrição, tecnologias..."
            >
            <button 
              x-show="searchQuery"
              @click="searchQuery = ''; filterProjects();"
              class="search-clear"
              type="button"
            >
              <i class="bi bi-x-lg"></i>
            </button>
          </div>
        </div>

        <!-- Filtros de Categoria -->
        <div class="category-filters mb-4">
          <label class="filter-label">
            <i class="bi bi-funnel me-2"></i>
            Filtrar por categoria:
          </label>
          <div class="category-badges">
            <button 
              class="category-badge"
              :class="{ 'active': !activeCategory }"
              @click="activeCategory = ''; filterProjects();"
            >
              <i class="bi bi-grid-3x3-gap me-1"></i>
              Todas
            </button>
            <template x-for="category in getUniqueCategories()" :key="category">
              <button 
                class="category-badge"
                :class="{ 'active': activeCategory === category }"
                @click="activeCategory = category; filterProjects();"
              >
                <i class="bi me-1" :class="getCategoryIcon(category)"></i>
                <span x-text="getCategoryLabel(category)"></span>
                <span class="badge-count" x-text="getCategoryCount(category)"></span>
              </button>
            </template>
          </div>
        </div>

        <!-- Contador e Limpar -->
        <div class="filters-footer">
          <div class="results-count">
            <span x-show="filteredProjects.length > 0">
              Mostrando <strong x-text="filteredProjects.length"></strong> de <strong x-text="projects.length"></strong> projetos
            </span>
            <span x-show="filteredProjects.length === 0 && !loading">
              Nenhum projeto encontrado
            </span>
          </div>
          <button 
            x-show="activeCategory || searchQuery"
            class="btn btn-outline-secondary btn-sm" 
            @click="clearFilters()"
          >
            <i class="bi bi-x-circle me-1"></i>
            Limpar Filtros
          </button>
        </div>
      </div>
    </section>

    <!-- Grid de Projetos -->
    <section class="projects-section">
      <div class="container">
        <!-- Loading State -->
        <div x-show="loading" class="loading-state">
          <div class="loading-spinner">
            <div class="spinner"></div>
          </div>
          <p class="loading-text">Carregando projetos...</p>
        </div>

        <!-- Empty State -->
        <div x-show="!loading && filteredProjects.length === 0" class="empty-state">
          <div class="empty-icon">
            <i class="bi bi-folder-x"></i>
          </div>
          <h3 class="empty-title">Nenhum projeto encontrado</h3>
          <p class="empty-text">
            <span x-show="activeCategory || searchQuery">
              Tente ajustar os filtros ou buscar por outros termos.
            </span>
            <span x-show="!activeCategory && !searchQuery">
              Não há projetos disponíveis no momento.
            </span>
          </p>
          <button 
            x-show="activeCategory || searchQuery"
            class="btn btn-primary mt-3" 
            @click="clearFilters()"
          >
            <i class="bi bi-arrow-counterclockwise me-2"></i>
            Limpar Filtros
          </button>
        </div>

        <!-- Projects Grid -->
        <div class="projects-grid" x-show="!loading && filteredProjects.length > 0">
          <template x-for="(project, index) in filteredProjects" :key="project.id">
            <div class="project-card-wrapper" :style="`animation-delay: ${index * 0.1}s`">
              <div class="project-card" @click="openModal(project)">
                <div class="project-image">
                  <img 
                    :src="project.imagem_url || 'https://via.placeholder.com/400x300?text=Sem+Imagem'" 
                    :alt="project.titulo"
                    loading="lazy"
                  >
                  <!-- Logo da Instituição -->
                  <img 
                    x-show="project.instituicao && project.instituicao.logo_url"
                    :src="project.instituicao.logo_url" 
                    :alt="project.instituicao.nome"
                    class="institution-logo-overlay"
                  >
                  <!-- Overlay com categoria -->
                  <div class="project-overlay">
                    <span class="category-badge-overlay" :class="'bg-' + getCategoryColor(project.categoria)">
                      <i class="bi" :class="getCategoryIcon(project.categoria)"></i>
                      <span x-text="getCategoryLabel(project.categoria)"></span>
                    </span>
                  </div>
                  <!-- Hover overlay -->
                  <div class="project-hover-overlay">
                    <div class="hover-content">
                      <i class="bi bi-eye-fill"></i>
                      <span>Ver Detalhes</span>
                    </div>
                  </div>
                </div>
                <div class="project-content">
                  <h4 class="project-title" x-text="project.titulo"></h4>
                  <p class="project-description" x-text="project.descricao_curta || 'Sem descrição'"></p>
                  
                  <!-- Tecnologias (se disponível) -->
                  <div class="project-tech" x-show="project.tecnologias && project.tecnologias.length > 0">
                    <template x-for="tech in project.tecnologias.slice(0, 3)" :key="tech">
                      <span class="tech-chip" x-text="tech"></span>
                    </template>
                    <span x-show="project.tecnologias.length > 3" class="tech-chip-more">
                      +<span x-text="project.tecnologias.length - 3"></span>
                    </span>
                  </div>
                  
                  <!-- Tags -->
                  <div class="project-tags" x-show="project.tags && project.tags.length > 0">
                    <template x-for="tag in project.tags.slice(0, 3)" :key="tag">
                      <span class="tag" x-text="tag"></span>
                    </template>
                    <span x-show="project.tags.length > 3" class="tag-more">
                      +<span x-text="project.tags.length - 3"></span>
                    </span>
                  </div>
                  
                  <!-- Links rápidos -->
                  <div class="project-actions" @click.stop>
                    <a 
                      :href="project.link_projeto" 
                      target="_blank"
                      rel="noopener noreferrer"
                      class="project-link"
                      x-show="project.link_projeto"
                      @click.stop
                    >
                      <i class="bi bi-box-arrow-up-right"></i>
                    </a>
                    <a 
                      :href="project.link_github" 
                      target="_blank"
                      rel="noopener noreferrer"
                      class="project-link"
                      x-show="project.link_github"
                      @click.stop
                    >
                      <i class="bi bi-github"></i>
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </template>
        </div>
      </div>
    </section>

    <!-- Modal Detalhes -->
    <div class="modal fade" id="projectModal" tabindex="-1" x-show="selectedProject" x-cloak>
      <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content project-modal-content" x-show="selectedProject">
          <!-- Header com gradiente -->
          <div class="modal-header project-modal-header">
            <div class="d-flex align-items-center gap-3 w-100">
              <!-- Logo da Instituição -->
              <div x-show="selectedProject?.instituicao && selectedProject?.instituicao?.logo_url" class="institution-logo-modal-wrapper">
                <img 
                  :src="selectedProject?.instituicao?.logo_url" 
                  :alt="selectedProject?.instituicao?.nome"
                  class="institution-logo-modal"
                >
              </div>
              <div class="flex-grow-1">
                <h4 class="modal-title mb-1" x-text="selectedProject?.titulo"></h4>
                <div class="d-flex align-items-center gap-2 flex-wrap">
                  <span class="badge project-category-badge" :class="'bg-' + getCategoryColor(selectedProject?.categoria)">
                    <i class="bi" :class="getCategoryIcon(selectedProject?.categoria)"></i>
                    <span x-text="getCategoryLabel(selectedProject?.categoria)"></span>
                  </span>
                  <span x-show="selectedProject?.instituicao" class="text-white-50 small">
                    <i class="bi bi-building"></i>
                    <span x-text="selectedProject?.instituicao?.nome"></span>
                  </span>
                  <span x-show="selectedProject?.data_projeto" class="text-white-50 small">
                    <i class="bi bi-calendar3"></i>
                    <span x-text="new Date(selectedProject?.data_projeto).toLocaleDateString('pt-BR', { year: 'numeric', month: 'long' })"></span>
                  </span>
                </div>
              </div>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
          </div>
          
          <!-- Body -->
          <div class="modal-body project-modal-body" x-show="selectedProject">
            <!-- Imagem do Projeto -->
            <div x-show="selectedProject?.imagem_url" class="project-modal-image mb-4">
              <img 
                :src="selectedProject?.imagem_url" 
                :alt="selectedProject?.titulo"
                class="img-fluid rounded-3 shadow-sm"
              >
            </div>
            
            <!-- Links de Ação -->
            <div x-show="selectedProject?.link_projeto || selectedProject?.link_github" class="project-action-buttons mb-4">
              <div class="d-flex gap-2 flex-wrap">
                <a 
                  :href="selectedProject?.link_projeto" 
                  target="_blank"
                  rel="noopener noreferrer"
                  class="btn btn-primary btn-lg"
                  x-show="selectedProject?.link_projeto"
                >
                  <i class="bi bi-box-arrow-up-right me-2"></i>
                  Ver Projeto
                </a>
                <a 
                  :href="selectedProject?.link_github" 
                  target="_blank"
                  rel="noopener noreferrer"
                  class="btn btn-dark btn-lg"
                  x-show="selectedProject?.link_github"
                >
                  <i class="bi bi-github me-2"></i>
                  Código Fonte
                </a>
              </div>
            </div>
            
            <!-- Descrição -->
            <div x-show="selectedProject?.descricao_completa || selectedProject?.descricao_curta" class="project-section mb-4">
              <h5 class="section-title">
                <i class="bi bi-file-text me-2"></i>
                Sobre o Projeto
              </h5>
              <p class="section-content" x-text="selectedProject?.descricao_completa || selectedProject?.descricao_curta"></p>
            </div>
            
            <!-- Tecnologias -->
            <div x-show="selectedProject?.tecnologias && selectedProject?.tecnologias.length > 0" class="project-section mb-4">
              <h5 class="section-title">
                <i class="bi bi-code-square me-2"></i>
                Tecnologias Utilizadas
              </h5>
              <div class="tech-badges">
                <template x-for="tech in selectedProject?.tecnologias" :key="tech">
                  <span class="tech-badge">
                    <i class="bi bi-check-circle-fill me-1"></i>
                    <span x-text="tech"></span>
                  </span>
                </template>
              </div>
            </div>
            
            <!-- Tags -->
            <div x-show="selectedProject?.tags && selectedProject?.tags.length > 0" class="project-section mb-4">
              <h5 class="section-title">
                <i class="bi bi-tags me-2"></i>
                Tags
              </h5>
              <div class="tag-badges">
                <template x-for="tag in selectedProject?.tags" :key="tag">
                  <span class="tag-badge" x-text="tag"></span>
                </template>
              </div>
            </div>
            
            <!-- Funcionalidades -->
            <div x-show="selectedProject?.funcionalidades && selectedProject?.funcionalidades.length > 0" class="project-section mb-4">
              <h5 class="section-title">
                <i class="bi bi-list-check me-2"></i>
                Funcionalidades
              </h5>
              <ul class="feature-list">
                <template x-for="func in selectedProject?.funcionalidades" :key="func">
                  <li>
                    <i class="bi bi-check-circle text-success me-2"></i>
                    <span x-text="func"></span>
                  </li>
                </template>
              </ul>
            </div>
            
            <!-- Conquistas -->
            <div x-show="selectedProject?.conquistas && selectedProject?.conquistas.length > 0" class="project-section mb-4">
              <h5 class="section-title">
                <i class="bi bi-trophy me-2"></i>
                Conquistas
              </h5>
              <ul class="achievement-list">
                <template x-for="conq in selectedProject?.conquistas" :key="conq">
                  <li>
                    <i class="bi bi-star-fill text-warning me-2"></i>
                    <span x-text="conq"></span>
                  </li>
                </template>
              </ul>
            </div>
          </div>
          
          <!-- Footer -->
          <div class="modal-footer project-modal-footer">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
              <i class="bi bi-x-lg me-2"></i>
              Fechar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <!-- Footer Component -->
    <div id="footer-placeholder"></div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- Scripts (deve carregar ANTES do Alpine.js) -->
  <script type="module">
    import('./assets/js/portfolio.js').then(() => {
      console.log('✅ portfolioGrid carregado');
      setTimeout(() => {
        if (window.portfolioGrid) {
          console.log('✅ portfolioGrid confirmado, carregando Alpine.js');
          const script = document.createElement('script');
          script.src = 'https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js';
          script.defer = true;
          document.body.appendChild(script);
        } else {
          console.error('❌ portfolioGrid não foi registrado!');
        }
      }, 50);
    }).catch(err => {
      console.error('❌ Erro ao carregar portfolio.js:', err);
    });
  </script>
  
  <!-- Components (deve carregar antes do Alpine.js) -->
  <script src="assets/js/components.js"></script>
  
  <!-- Menu Secreto Admin -->
  <script src="assets/js/secret-menu.js"></script>
  
  <!-- PWA Scripts (Component) -->
  <script>
    if (window.renderPWAScripts) {
      document.write(window.renderPWAScripts());
    }
  </script>
</body>
</html>

